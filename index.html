<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle Apology</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        text-align: center;
        padding: 20px;
    }

    .card {
        background: white;
        width: 360px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    #puzzleContainer {
        width: 300px;
        height: 300px;
        margin: 0 auto;
        position: relative;
        border: 3px solid #222;
        background: #ddd;
        border-radius: 10px;
    }

    .tile {
        position: absolute;
        border: 1px solid #333;
        cursor: pointer;
        background-size: 300px 300px;
    }

    #messageCard {
        display: none;
    }

    button {
        margin-top: 10px;
        padding: 10px 15px;
        border: none;
        background: #333;
        color: white;
        border-radius: 8px;
        cursor: pointer;
    }

    button:hover {
        background: #555;
    }
</style>
</head>

<body>

<!-- Puzzle Selector Box -->
<div class="card">
    <h2>Choose Puzzle Size</h2>
    <button onclick="startPuzzle(2)">2 × 2</button>
    <button onclick="startPuzzle(3)">3 × 3</button>
    <button onclick="startPuzzle(4)">4 × 4</button>
</div>

<!-- Puzzle Box -->
<div class="card">
    <h2>Your Puzzle</h2>
    <div id="puzzleContainer"></div>
</div>

<!-- Message Box -->
<div id="messageCard" class="card">
    <h2>I'm Really Sorry ❤️</h2>
    <p>I hope this little puzzle made you smile…  
    You mean so much to me, and I truly want us to be okay.</p>
</div>

<script>
let emptyX, emptyY, gridSize;
const imageURL = "your-image.jpg"; // PLACE YOUR IMAGE HERE

function startPuzzle(size) {
    const container = document.getElementById("puzzleContainer");
    container.innerHTML = "";
    gridSize = size;

    const tileSize = 300 / size;
    let tiles = [];

    // create tiles
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
            if (x === size - 1 && y === size - 1) {
                emptyX = x;
                emptyY = y;
                continue;
            }

            let tile = document.createElement("div");
            tile.className = "tile";
            tile.style.width = tileSize + "px";
            tile.style.height = tileSize + "px";

            tile.style.left = (x * tileSize) + "px";
            tile.style.top = (y * tileSize) + "px";

            tile.dataset.correctX = x;
            tile.dataset.correctY = y;

            tile.style.backgroundImage = `url('${imageURL}')`;
            tile.style.backgroundPosition =
                `-${x * tileSize}px -${y * tileSize}px`;

            tile.addEventListener("click", () => moveTile(tile, x, y));
            tiles.push(tile);
        }
    }

    // Shuffle tiles
    tiles = shuffleTiles(tiles);

    let i = 0;
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
            if (x === emptyX && y === emptyY) continue;

            let tile = tiles[i];
            tile.style.left = (x * tileSize) + "px";
            tile.style.top = (y * tileSize) + "px";
            tile.dataset.x = x;
            tile.dataset.y = y;
            container.appendChild(tile);
            i++;
        }
    }
}

function shuffleTiles(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function moveTile(tile) {
    let x = parseInt(tile.dataset.x);
    let y = parseInt(tile.dataset.y);

    if ((Math.abs(x - emptyX) === 1 && y === emptyY) ||
        (Math.abs(y - emptyY) === 1 && x === emptyX)) {

        let tileSize = 300 / gridSize;

        tile.style.left = (emptyX * tileSize) + "px";
        tile.style.top = (emptyY * tileSize) + "px";

        tile.dataset.x = emptyX;
        tile.dataset.y = emptyY;

        emptyX = x;
        emptyY = y;

        checkWin();
    }
}

function checkWin() {
    const tiles = document.querySelectorAll(".tile");
    for (let tile of tiles) {
        if (tile.dataset.x != tile.dataset.correctX ||
            tile.dataset.y != tile.dataset.correctY) {
            return;
        }
    }
    document.getElementById("messageCard").style.display = "block";
}
</script>

</body>
</html>
