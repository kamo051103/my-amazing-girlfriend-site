<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #options button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }

        #content {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Admin Page</h1>
    <button id="update-paragraph-btn">Update Cute Message</button>
    <button id="change-background-btn">Change Background</button>
    <button id="change-video-btn">Change Cute Video</button>
    <button id="logout-btn">Log Out</button>

    <div id="content"></div>

    <script>
        // GitHub API Setup
        const repoOwner = 'your-github-username';  // Replace with your GitHub username
        const repoName = 'your-repo-name';  // Replace with your repository name
        const filePath = 'data.json';  // The path to your data.json file in the repo
        const branch = 'main';  // The branch name (usually 'main')
        const token = 'your-personal-access-token';  // Replace with your GitHub personal access token

        // Function to fetch current content of data.json from GitHub
        async function getFileContent() {
            const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}?ref=${branch}`;

            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${token}`, // Authorization header with your token
                },
            });

            if (!response.ok) {
                throw new Error('Failed to fetch file content');
            }

            const data = await response.json();
            return data; // Returns the file data including sha
        }

        // Function to update data.json file on GitHub
        async function updateDataJson(newContent) {
            try {
                // Fetch the current file details (including SHA)
                const currentFile = await getFileContent();
                const sha = currentFile.sha; // Get the SHA of the current file version

                // Prepare the API URL for updating the file
                const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

                // Prepare the body for the PUT request
                const body = JSON.stringify({
                    message: 'Update data.json from Admin Page',  // Commit message for update
                    content: btoa(JSON.stringify(newContent)),  // Base64 encoded content to update (new data)
                    sha: sha,  // SHA of the file to update
                    branch: branch,  // GitHub branch
                });

                // Send the PUT request to update the file on GitHub
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: body,
                });

                if (!response.ok) {
                    throw new Error('Failed to update file');
                }

                const result = await response.json();
                console.log('File updated successfully:', result);
                alert('data.json updated successfully!');
            } catch (error) {
                console.error('Error updating file:', error);
                alert('Failed to update data.json');
            }
        }

        // Example: Update data.json with new content
        const newData = {
            "cuteMessage": "Hello Baby, I love you more!",  // New cute message
            "backgroundUrl": "https://new-image-link.com/photo.jpg",  // New image URL
            "cuteVideo": "https://new-video-link.com/video.mp4",  // New video URL
            "photoLinks": [
                "https://new-image-link.com/photo1.jpg",
                "https://new-image-link.com/photo2.jpg"
            ],
            "videoLinks": [
                "https://new-video-link.com/video1.mp4",
                "https://new-video-link.com/video2.mp4"
            ]
        };

        // Admin page button event listeners
        document.getElementById('update-paragraph-btn').addEventListener('click', () => {
            const newCuteMessage = prompt('Enter new cute message:');
            newData.cuteMessage = newCuteMessage;
            updateDataJson(newData); // Call to update the data.json
        });

        document.getElementById('change-background-btn').addEventListener('click', () => {
            const newBackgroundUrl = prompt('Enter new background URL:');
            newData.backgroundUrl = newBackgroundUrl;
            updateDataJson(newData); // Call to update the data.json
        });

        document.getElementById('change-video-btn').addEventListener('click', () => {
            const newCuteVideo = prompt('Enter new cute video URL:');
            newData.cuteVideo = newCuteVideo;
            updateDataJson(newData); // Call to update the data.json
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            window.location.reload(); // Log out by refreshing the page
        });
    </script>
</body>
</html>
